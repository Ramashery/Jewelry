# --- Файл: netlify.toml (ФИНАЛЬНАЯ ВЕРСИЯ) ---

[build]
  command = "pip install -r requirements.txt && python generate_site.py"
  publish = "public"

# ==============================================================================
# ШАГ 1: 301 РЕДИРЕКТЫ (Перенаправляем старые URL на новые для SEO)
# ==============================================================================

# --- 1.1. Редирект для старых URL товаров (?slug=...) ---
[[redirects]]
  from = "/product.html"
  query = {slug = ":slug"}
  to = "/product/:slug"
  status = 301
  force = true

# --- 1.2. Редиректы для старых URL постов блога (?slug=...) ---
[[redirects]]
  from = "/en/post.html"
  query = {slug = ":slug"}
  to = "/en/post/:slug"
  status = 301
  force = true

[[redirects]]
  from = "/ru/post.html"
  query = {slug = ":slug"}
  to = "/ru/post/:slug"
  status = 301
  force = true

[[redirects]]
  from = "/ka/post.html"
  query = {slug = ":slug"}
  to = "/ka/post/:slug"
  status = 301
  force = true

# --- 1.3. Убираем .html из URL ---
[[redirects]]
  from = "/about.html"
  to = "/about"
  status = 301
  force = true

[[redirects]]
  from = "/blog.html"
  to = "/blog"
  status = 301
  force = true

[[redirects]]
  from = "/cast.html"
  to = "/cast"
  status = 301
  force = true

[[redirects]]
  from = "/index.html"
  to = "/"
  status = 301
  force = true

# --- 1.4. Редирект со старого домена на новый ---
[[redirects]]
  from = "https://jewelrycraftstbilisi.netlify.app/*"
  to = "https://minankari.art/:splat"
  status = 301
  force = true

# ==============================================================================
# ШАГ 2: 200 REWRITES (Отдаем нужный контент по чистым URL)
# ==============================================================================

# --- 2.1. Rewrite для новых URL товаров ---
# Запрос на /product/my-ring -> отдать файл /product/my-ring/index.html
[[redirects]]
  from = "/product/:slug"
  to = "/product/:slug/index.html"
  status = 200

# --- 2.2. Rewrites для новых URL постов блога ---
# Запрос на /en/post/my-article -> отдать файл /en/post.html (JS разберется)
[[redirects]]
  from = "/en/post/:slug"
  to = "/en/post.html"
  status = 200

[[redirects]]
  from = "/ru/post/:slug"
  to = "/ru/post.html"
  status = 200

[[redirects]]
  from = "/ka/post/:slug"
  to = "/ka/post.html"
  status = 200

# --- 2.3. Rewrites для основных страниц (чтобы работали без .html) ---
[[redirects]]
  from = "/about"
  to = "/about.html"
  status = 200

[[redirects]]
  from = "/blog"
  to = "/blog.html"
  status = 200

[[redirects]]
  from = "/cast"
  to = "/cast.html"
  status = 200