# ===============================================================
# Netlify Configuration File (Stable Version)
# ===============================================================

# --- Секция Сборки ---
[build]
  command = "pip install -r requirements.txt && python generate_site.py"
  publish = "public"

# --- Секция Переадресации и Перезаписи ---

# ПРАВИЛО №1: "Невидимая" перезапись (Rewrite) для нашего основного URL
# Когда кто-то заходит на .../product.html?slug=...
[[redirects]]
  from = "/product.html"
  query = {slug = ":slug"}
  # ...мы "под капотом" отдаем ему контент из сгенерированного файла.
  to = "/product/:slug/index.html"
  status = 200

# ПРАВИЛО №2: Редирект с "чистого" URL-дубликата на основной URL
# Когда кто-то заходит на .../product/slug/
[[redirects]]
  from = "/product/:slug/"
  # ...мы делаем 301 редирект на наш основной URL.
  to = "/product.html?slug=:slug"
  status = 301
  force = true
