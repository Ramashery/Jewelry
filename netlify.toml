[build]
  command = "pip install -r requirements.txt && python generate_site.py"
  publish = "public"

# ==============================================================================
# ШАГ 1: 301 РЕДИРЕКТЫ (Переезд старых ссылок)
# ==============================================================================

# 1.1. Товары: перенаправляем ?slug=... на чистый URL
# Примечание: Netlify сохранит ?slug в конце ссылки, мы уберем это через JS
[[redirects]]
  from = "/product.html"
  query = {slug = ":slug"}
  to = "/product/:slug/"
  status = 301
  force = true

# 1.2. Блог: перенаправляем старые ссылки
[[redirects]]
  from = "/en/post.html"
  query = {slug = ":slug"}
  to = "/en/post/:slug/"
  status = 301
  force = true

[[redirects]]
  from = "/ru/post.html"
  query = {slug = ":slug"}
  to = "/ru/post/:slug/"
  status = 301
  force = true

[[redirects]]
  from = "/ka/post.html"
  query = {slug = ":slug"}
  to = "/ka/post/:slug/"
  status = 301
  force = true

# 1.3. Убираем .html
[[redirects]]
  from = "/about.html"
  to = "/about"
  status = 301
  force = true

[[redirects]]
  from = "/blog.html"
  to = "/blog"
  status = 301
  force = true

[[redirects]]
  from = "/cast.html"
  to = "/cast"
  status = 301
  force = true

[[redirects]]
  from = "/index.html"
  to = "/"
  status = 301
  force = true

# 1.4. Редирект со старого домена
[[redirects]]
  from = "https://jewelrycraftstbilisi.netlify.app/*"
  to = "https://minankari.art/:splat"
  status = 301
  force = true

# ==============================================================================
# ШАГ 2: 200 REWRITES (Отдаем сгенерированные файлы)
# ==============================================================================

# ВАЖНОЕ ИСПРАВЛЕНИЕ: Мы указываем путь к index.html внутри папки,
# так как Python-скрипт теперь создает структуру /slug/index.html

# 2.1. Товары
[[redirects]]
  from = "/product/:slug"
  to = "/product/:slug/index.html"
  status = 200

# 2.2. Блог (ИСПРАВЛЕННАЯ ОШИБКА)
# Раньше тут был путь к .html файлу, что игнорировало сгенерированные папки
[[redirects]]
  from = "/en/post/:slug"
  to = "/en/post/:slug/index.html"
  status = 200

[[redirects]]
  from = "/ru/post/:slug"
  to = "/ru/post/:slug/index.html"
  status = 200

[[redirects]]
  from = "/ka/post/:slug"
  to = "/ka/post/:slug/index.html"
  status = 200

# 2.3. Основные страницы
[[redirects]]
  from = "/about"
  to = "/about.html"
  status = 200

[[redirects]]
  from = "/blog"
  to = "/blog.html"
  status = 200

[[redirects]]
  from = "/cast"
  to = "/cast.html"
  status = 200
