# ===============================================================
# Netlify Configuration File (Stable Version)
# ===============================================================

# --- Секция Сборки ---
[build]
  command = "pip install -r requirements.txt && python generate_site.py"
  publish = "public"

# --- Секция Переадресации и Перезаписи ---
# Правила читаются сверху вниз. Первое совпавшее правило срабатывает.

# --- ИСПРАВЛЕННЫЕ И ДОПОЛНЕННЫЕ ПРАВИЛА ---

# ПРАВИЛО №A.1: Редирект для корневого /index.html на / (самое важное)
# Это правило ловит конкретный случай https://minankari.art/index.html
# и перенаправляет на https://minankari.art/
[[redirects]]
  from = "/index.html"
  to = "/"
  status = 301
  force = true

# ПРАВИЛО №A.2: Редирект для index.html во вложенных папках
# Это правило ловит все остальные случаи, например: /about/index.html -> /about/
[[redirects]]
  from = "/*/index.html"
  to = "/:splat"
  status = 301
  force = true

# ПРАВИЛО №B: Редирект с технического домена Netlify на основной
# Убирает дубликат сайта на jewelrycraftstbilisi.netlify.app.
# :splat сохраняет путь (например, /about -> /about)
[[redirects]]
  from = "https://jewelrycraftstbilisi.netlify.app/*"
  to = "https://minankari.art/:splat"
  status = 301
  force = true

# --- ВАШИ СУЩЕСТВУЮЩИЕ ПРАВИЛА (остаются без изменений) ---

# ПРАВИЛО №1: "Невидимая" перезапись (Rewrite) для нашего основного URL
# Когда кто-то заходит на .../product.html?slug=...
[[redirects]]
  from = "/product.html"
  query = {slug = ":slug"}
  # ...мы "под капотом" отдаем ему контент из сгенерированного файла.
  to = "/product/:slug/index.html"
  status = 200

# ПРАВИЛО №2: Редирект с "чистого" URL-дубликата на основной URL
# Когда кто-то заходит на .../product/slug/
[[redirects]]
  from = "/product/:slug/"
  # ...мы делаем 301 редирект на наш основной URL.
  to = "/product.html?slug=:slug"
  status = 301
  force = true
