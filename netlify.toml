# ===============================================================
# Netlify Configuration File
# ===============================================================

# --- Секция Сборки (Build Settings) ---
[build]
  command = "pip install -r requirements.txt && python generate_site.py"
  publish = "public"

# --- Секция Переадресации и Перезаписи (Redirects & Rewrites) ---

# ПРАВИЛО №1: "Невидимая" перезапись (Rewrite)
# Когда кто-то заходит на наш основной URL...
[[redirects]]
  from = "/product.html"
  query = {slug = ":slug"}
  # ...мы "под капотом" отдаем ему контент из сгенерированного файла.
  to = "/product/:slug/index.html"
  # Статус 200 означает, что URL в браузере НЕ МЕНЯЕТСЯ.
  status = 200

# ПРАВИЛО №2 (НОВОЕ): Редирект с дубликата на основной URL
# Когда кто-то заходит на "чистый" URL, который создает Netlify...
[[redirects]]
  from = "/product/:slug/"
  # ...мы делаем постоянный 301 редирект...
  to = "/product.html?slug=:slug"
  # ...на наш основной, "старый" URL.
  status = 301
  force = true # Принудительно выполнить редирект
