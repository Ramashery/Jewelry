# ===============================================================
# Netlify Configuration File (Final Version)
# ===============================================================

# --- Секция Сборки ---
[build]
  command = "pip install -r requirements.txt && python generate_site.py"
  publish = "public"

# --- Секция Переадресации и Перезаписи ---

# ПРАВИЛО №1 (НОВОЕ): Убираем лишний слеш в конце slug
# Если кто-то зашел на URL, где slug заканчивается на /
[[redirects]]
  from = "/product.html"
  query = {slug = ":slug/"} # :slug/ ловит значение со слешем на конце
  # ...делаем 301 редирект на версию без слеша.
  to = "/product.html?slug=:slug"
  status = 301
  force = true

# ПРАВИЛО №2: "Невидимая" перезапись (Rewrite) для основного URL
# Это правило должно идти ПОСЛЕ правила для слеша.
[[redirects]]
  from = "/product.html"
  query = {slug = ":slug"}
  to = "/product/:slug/index.html"
  status = 200

# ПРАВИЛО №3: Редирект с "чистого" URL-дубликата на основной URL
[[redirects]]
  from = "/product/:slug/"
  to = "/product.html?slug=:slug"
  status = 301
  force = true
