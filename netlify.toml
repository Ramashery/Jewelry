# =================================================================
# Netlify Configuration File (SSG Products + Clean Static URLs)
# =================================================================

[build]
  command = "pip install -r requirements.txt && python generate_site.py"
  publish = "public"

# --- ПРАВИЛА ПЕРЕАДРЕСАЦИИ И ПЕРЕЗАПИСИ ---

# ПРАВИЛО 1: "Невидимая" перезапись для страниц товаров (SSG)
# Когда кто-то заходит на .../product.html?slug=...
# Netlify "под капотом" отдает ему сгенерированный файл.
# Это правило сохраняет вашу текущую структуру URL для товаров.
[[redirects]]
  from = "/product.html"
  query = {slug = ":slug"}
  to = "/product/:slug/index.html"
  status = 200 # 200 = Rewrite (невидимая перезапись)

# ПРАВИЛО 2: Принудительный 301 редирект с .html на "чистые" URL.
# Работает для /about.html, /ru/blog.html и т.д.
# КРИТИЧЕСКИ ВАЖНО для SEO, чтобы избавиться от дублей.
[[redirects]]
  from = "/:page.html"
  to = "/:page"
  status = 301
  force = true
  # Ограничение: правило сработает только для about, blog, cast
  conditions = {Path = ["^/(about|blog|cast)\\.html$"]}

[[redirects]]
  from = "/:lang/:page.html"
  to = "/:lang/:page"
  status = 301
  force = true
  # Ограничение: сработает для /ru/about.html, /en/blog.html и т.д.
  conditions = {Path = ["^/(en|ru|ka)/(about|blog|cast)\\.html$"]}

# ПРАВИЛО 3: "Невидимая" перезапись для "чистых" URL.
# Когда пользователь заходит на /about, Netlify отдает ему содержимое /about.html
[[redirects]]
  from = "/:page"
  to = "/:page.html"
  status = 200
  conditions = {Path = ["^/(about|blog|cast)/?$"]}

[[redirects]]
  from = "/:lang/:page"
  to = "/:lang/:page.html"
  status = 200
  conditions = {Path = ["^/(en|ru|ka)/(about|blog|cast)/?$"]}

# --- ОБЩИЕ ПРАВИЛА САЙТА ---

# ПРАВИЛО 4: Редиректы для /index.html на корень папки.
# Пример: /ru/index.html -> /ru/
[[redirects]]
  from = "/index.html"
  to = "/"
  status = 301
  force = true

[[redirects]]
  from = "/:lang/index.html"
  to = "/:lang/"
  status = 301
  force = true
  conditions = {Path = ["^/(en|ru|ka)/index\\.html$"]}

# ПРАВИЛО 5: Редирект с технического домена Netlify на основной
[[redirects]]
  from = "https://jewelrycraftstbilisi.netlify.app/*"
  to = "https://minankari.art/:splat"
  status = 301
  force = true
