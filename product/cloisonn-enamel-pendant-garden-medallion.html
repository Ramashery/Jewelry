<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://firestore.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="//firestore.googleapis.com">
    <link rel="dns-prefetch" href="//www.gstatic.com">
    
    <!-- SEO-теги теперь вставляет Python -->
    <title>Cloisonné Enamel Pendant "Garden Medallion" | Silver Handmade in Tbilisi | Nino Kartsivadze</title>
    <meta name="description" content="Discover the "Garden Medallion" by Nino Kartsivadze, a handmade cloisonné enamel (Minankari) pendant meticulously crafted from sterling silver in Tbilisi, Georg">
    
    <!-- JS для быстрой подгрузки SEO-тегов ОСТАЕТСЯ, он нужен для ссылок с ?slug= -->
    <script>
        (function earlySeoBootstrap() {
            try {
                var API_KEY = "AIzaSyAxOUOxaufE60eVuyOq_P66MJ9ls_7p470";
                var PROJECT_ID = "nini-shop-7c89d";
                var slug = new URLSearchParams(location.search).get('slug');
                if (!slug) return; // Если слага нет, ничего не делаем, показываем статику
                var endpoint = "https://firestore.googleapis.com/v1/projects/" + PROJECT_ID + "/databases/(default)/documents:runQuery?key=" + API_KEY;
                var body = {
                    structuredQuery: {
                        from: [{ collectionId: 'products' }],
                        where: { fieldFilter: { field: { fieldPath: 'slug' }, op: 'EQUAL', value: { stringValue: slug } } },
                        limit: 1
                    }
                };
                fetch(endpoint, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) })
                    .then(r => r.json())
                    .then(rows => {
                        var doc = Array.isArray(rows) ? rows.find(x => x && x.document)?.document : null;
                        if (!doc || !doc.fields) return;
                        var fields = doc.fields;
                        var title = (fields.seoTitle && fields.seoTitle.stringValue) || (fields.title && fields.title.stringValue) || '';
                        var description = (fields.metaDescription && fields.metaDescription.stringValue) || (fields.description && fields.description.stringValue) || '';
                        
                        if (title) { document.title = title + ' | Nino Kartsivadze'; }
                        var md = document.querySelector('meta[name="description"]'); 
                        if (md) { md.setAttribute('content', description.substring(0, 160)); }
                    });
            } catch(e) {}
        })();
    </script>
    
    <style>
        :root { --primary: #D4AF37; --bg: #121212; --text-light: rgba(255, 255, 255, 0.9); } 
        body { background: var(--bg); color: var(--text-light); font-family: 'Montserrat', sans-serif; }
        /* Сокращенные стили для примера, ваши полные стили должны быть здесь */
        #page-content-wrapper.hidden { display: none; }
        .message-container { text-align: center; font-size: 1.5rem; padding: 5rem 1rem; color: var(--primary); }
    </style>
</head>
<body>
    
    <!-- Этот блок будет виден только если JS не найдет товар по slug -->
    <div id="static-content">
        
        <div class="product-page-container">
            <h1 class="product-title">Cloisonné Enamel Pendant "Garden Medallion"</h1>
            <!-- Здесь можно добавить больше статики: описание, цену и т.д. -->
        </div>
        
    </div>

    <!-- Этот блок будет заполняться через JS, как и раньше -->
    <div id="page-content-wrapper"></div>
    <div id="message-container" class="message-container" style="display:none;">Loading masterpiece...</div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        // Ваш старый JS-код для загрузки товара
        async function initializeProductPage() {
            const params = new URLSearchParams(window.location.search);
            const productSlug = params.get('slug');

            // Если есть slug, прячем статику и показываем загрузчик
            if (productSlug) {
                document.getElementById('static-content').style.display = 'none';
                document.getElementById('message-container').style.display = 'block';
            } else {
                return; // Если слага нет, ничего не делаем, оставляем статику
            }
            
            // ... (здесь весь ваш остальной код из initializeProductPage, который ищет товар в Firebase и рендерит его)
            // Он должен заканчиваться скрытием message-container и показом page-content-wrapper
        }
        // Убедитесь, что ваш JS вызывает initializeProductPage()
        initializeProductPage();
    </script>
</body>
</html>